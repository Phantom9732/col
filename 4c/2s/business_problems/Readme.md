### **Бизнес-задача: Безопасная передача паролей между сотрудниками**


### **1. Бизнес-требование**

**Описание:** "Я, как руководитель отдела, хочу иметь возможность безопасно передавать временные пароли новым сотрудникам или сотрудникам, сбросившим пароль, таким образом, чтобы минимизировать риск их перехвата или несанкционированного использования. Передача должна быть простой и не требовать личной встречи или звонка."

*   **Пример 1:** "Я, как менеджер, хочу отправить Антону временный пароль для входа в CRM, чтобы он мог настроить себе постоянный."
*   **Пример 2:** "Я, как сотрудник IT-поддержки, хочу предоставить пользователю доступ к его заблокированной учетной записи, отправив ему одноразовую ссылку для входа."


### **2. Функциональное требование**

**Функция:** Генерация и отправка одноразовой ссылки для входа.

**Поведение:**
1.  После того как авторизованный сотрудник, каким может быть менеджер или IT-специалист, переходит в специальный раздел веб-приложения "Безопасная передача паролей", система предоставляет форму, где он указывает:
    *   Email сотрудника-получателя.
    *   Название секрета (не обязательно).
    *   Срок действия ссылки (например, 24 часа).
2.  После заполнения сотрудником формы и нажатия кнопки "Сгенерировать ссылку", система:
    *   Создает уникальную одноразовую ссылку со сложным криптостойким токеном.
    *   Создает запись в системе о том, что этот токен связан с email'ом получателя, устанавливает статус "не использован" и время истечения действия.
    *   Отправляет от имени получателя письмо со ссылкой для входа.
3.  Получатель переходит по ссылке из письма
4.  В этот момент система проверяет, существует ли такая ссылка, не истек ли срок действия и не была ли она ранее использована.
5.  Если все проверки пройдены успешно, система автоматически авторизует получателя в системе (лучше перенаправляет его на форму смены пароля), помечает ссылку "использованной", не позволяя использовать ее в следующий раз.
6.  Если хоть одна проверка не прошла, система показывает соответствующее сообщение получателю (например, "Ссылка с истекшим сроком или уже использована").


### **3. Техническое задание**

**Задача:** Реализовать сервис генерации и валидации одноразовых ссылок для входа.

**1. База данных. Создать таблицу `one_time_links` в схеме `security`:**

| Имя поля         | Тип         | Обязательность | Описание                                                                 |
| ----------------- | ----------- | -------------- | ------------------------------------------------------------------------ |
| id                | uuid (PK)   | да             | Уникальный идентификатор записи.                                         |
| token_hash        | varchar(512)| да             | **Хэш** токена (алгоритм: bcrypt).                      |
| recipient_email   | varchar(255)| да             | Email адрес получателя.                                             |
| created_by_user_id| uuid        | да             | ID отправителя (FK на `users.id`).             |
| expires_at        | timestamptz | да             | Дата и время истечения срока действия ссылки.                            |
| used_at           | timestamptz | нет            | Дата и время использования ссылки. `NULL` - не использована.             |
| created_at        | timestamptz | да             | Дата и время создания записи.                                            |

**2. Эндпоинт для генерации ссылки:**
*   **HTTP-метод:** POST
*   **Path:** `/api/v1/one-time-links`
*   **Тело запроса (объект `GenerateLinkRequest`):**
    | Поле           | Обязательность | Тип     | Описание                          |
    | -------------- | -------------- | ------- | --------------------------------- |
    | recipientEmail | да             | String  | Email адрес получателя.                 |
    | systemName     | нет            | String  | Название системы-цели.            |
    | expiresInHours | да             | Integer | Срок действия ссылки. |

*   **Ответ (успех, статус 201):**
    | Поле | Обязательность | Тип    | Описание                                     |
    | ---- | -------------- | ------ | -------------------------------------------- |
    | id   | да             | String | ID созданной записи (`one_time_links.id`).   |
    *   **Важно:** Полный URL с токеном **не возвращается** в ответе API. Он сразу отправляется на email.

**3. Эндпоинт для обработки перехода по ссылке:**
*   **HTTP-метод:** GET
*   **Path:** `/auth/one-time-login/{token}`
*   **Параметры пути:**
    | Поле  | Описание                 |
    | ----- | ------------------------ |
    | token | Одноразовый токен из URL.|

*   **Алгоритм работы:**
    1.  Найти запись в таблице `one_time_links`, для которой `token_hash` соответствует переданному `token`.
    2.  Если запись не найдена -> вернуть HTTP-статус `404 Not Found`.
    3.  Если `used_at IS NOT NULL` -> вернуть HTTP-статус `410 Gone` ("Ссылка уже использована").
    4.  Если `expires_at < NOW()` -> вернуть HTTP-статус `410 Gone` ("Срок действия ссылки истек").
    5.  Если все проверки пройдены:
        *   Обновить запись, установив `used_at = NOW()`.
        *   Найти или создать учетную запись пользователя по `recipient_email`.
        *   Сгенерировать стандартную сессию (JWT-токен) для этого пользователя.
        *   Перенаправить пользователя на главную страницу приложения с установленным токеном авторизации.
        *   *Альтернатива:* Перенаправить пользователя на форму смены пароля, если задача - именно сброс, а не одноразовый вход.

**4. Отправка email:**
*   **Сервис:** Интегрироваться с почтовым сервисом (например, SendGrid, SMTP).
*   **Текст письма:** Сгенерировать HTML-письмо, содержащее ссылку вида `https://{our-domain}/auth/one-time-login/{token}` и предупреждение о конфиденциальности и ограниченном сроке действия.


### **4. Техническая реализация**

В рамках задачи было реализовано следующее:
1.  **База данных:** Создана таблица `one_time_links` в схеме `security` с указанными полями. Добавлены индексы по `token_hash` и `expires_at`.
2.  **Бэкенд:**
    *   Реализован эндпоинт `POST /api/v1/one-time-links` с валидацией входящих данных, генерацией токена (с использованием crypto-strong random), его хэшированием (bcrypt) и сохранением записи в БД.
    *   Реализован эндпоинт `GET /auth/one-time-login/{token}` с проверкой и авторизацией.
    *   Интегрирован сервис отправки email через Amazon SES.
3.  **Фронтенд:** В Личном кабинете администратора добавлен раздел "Безопасная передача паролей" с React-компонентом формы для генерации ссылки.


### **5. Участники команды и их обязанности**

#### **Лучший случай (идеальная укомплектованность)**

1.  **Бизнес-аналитик:**
    *   **Обязанности:** Общается с руководителями отделов, чтобы сформулировать **бизнес-требование**. Выясняет детали: какие пароли передаются, кто имеет право генерировать ссылки, какой должен быть срок жизни, нужна ли аудитория (кто, кому и когда отправил). Преобразует эти данные в **функциональное требование**.

2.  **Системный аналитик:**
    *   **Обязанности:** На основе функционального требования, описанного бизнес-аналитиком, разрабатывает **техническое задание**. Определяет, какие именно таблицы нужны в БД, какие эндпоинты создать, продумывает алгоритм хэширования токенов для безопасности, структуру писем и схему взаимодействия с почтовым сервисом.

3.  **Разработчик (Middle/Senior):**
    *   **Обязанности:**  Пишет код системы, тестирует, разворачивает продукт на тестовом стенде.

#### **Случай ограниченных ресурсов**

1.  **Аналитик (гибрид бизнес-/системного):**
    *   **Обязанности:** Совмещает две роли. Общается с бизнесом, фиксирует их потребности, и сразу преобразует их в детализированное **техническое задание**, минуя этап глубокого функционального требования. Должен понимать и предметную область (безопасность, процессы онбординга), и технические ограничения (безопасность токенов, работа с БД, email).

2.  **Senior-разработчик:**
    *   **Обязанности:** Выполняет роль и разработчика, и частично системного аналитика. Получает от гибрид-аналитика или напрямую от бизнеса укороченное **функциональное требование**. Сам проводит его детальный анализ, проектирует и финализирует **техническое задание** (например, сам выбирает bcrypt для хэширования и проектирует схему БД), после чего самостоятельно его реализует.

### **Может ли бизнес-задача быть решена через проект?**

Задача «Реализация безопасной передачи паролей между сотрудниками при помощи одноразовых ссылок» является классическим **проектом**.

Она соответствует всем ключевым признакам проекта:

1.  **Ограниченное время.** Задача имеет четкое начало (принятие решения о разработке) и конец (ввод функционала в эксплуатацию и обучение пользователей). Сроки могут быть, например, 2-3 месяца.
2.  **Четкая цель.** Стратегическая цель - «Снизить риски утечки учетных данных при передаче паролей между сотрудниками на X% к 1 декабря 2024 года».
3.  **Ограниченные ресурсы.** На реализацию будет выделен определенный бюджет (труд разработчиков, возможные лицензии на почтовые сервисы) и команда из нескольких человек (аналитик, разработчик, тестировщик).
4.  **Уникальный результат.** Будет создан новый, не существовавший ранее в компании, программный модуль или сервис «Безопасная передача паролей».
5.  **Однократное исполнение.** Это не регулярный процесс (как, например, ежемесячная отправка зарплатных ведомостей), а разовая работа по созданию нового механизма.



### **Виды проекта**

| Признак классификации | Вид проекта | Обоснование |
| :--- | :--- | :--- |
| **Содержание / Сфера реализации** | **Технический** и **Организационный** | Ядро проекта - **техническое** (разработка ПО, интеграция с email). Однако он включает **организационную** составляющую: изменение процесса онбординга сотрудников и сброса паролей, обучение пользователей. |
| **Структура** | **Индивидуальный** | Проект направлен на решение одной конкретной задачи (безопасная передача паролей) и не распадается на несколько крупных независимых подпроектов. |
| **Длительность** | **Краткосрочный** (до 3 лет) | Ожидаемый срок реализации - несколько месяцев, что явно попадает в категорию краткосрочных. |
| **Сложность** | **Простой / Средний** | Проект может быть реализован силами собственной команды (простой). Если потребуются сторонние подрядчики для разработки или сложных интеграций, он перейдет в категорию средних. Для крупной компании с устоявшимися процессами это простой проект. |



### **Этапы жизненного цикла решения для данной бизнес-задачи**

**1. Замысел (Инициация)**
*   **Возникновение идеи:** Руководитель IT-отдела или службы безопасности инициирует проект, аргументируя его необходимость: «Текущий процесс передачи паролей через мессенджеры/email небезопасен и ведет к рискам утечки».
*   **Предварительные исследования:** Оцениваются масштабы проблемы (сколько раз в месяц передаются пароли, какие системы involved), возможные решения на рынке (готовые VS кастомная разработка).
*   **Постановка целей:** Формулируется **SMART-цель** проекта: «Разработать и внедрить в компании «Альфа» к 25 декабря 2024 года механизм безопасной передачи учетных данных, позволяющий отправлять одноразовые ссылки для входа, что снизит количество инцидентов, связанных с перехватом паролей, на 100%». Утверждается у спонсора проекта.

**2. Планирование**
*   **Разработка концепции:** Бизнес-аналитик (или системный аналитик) детализирует требования, как это было сделано в прошлом задании (бизнес-требование -> функциональное требование -> техническое задание).
*   **Поиск и подготовка ресурсов:** Формируется команда (назначаются аналитик, разработчик, тестировщик). Выделяется серверное время, тестовые среды, бюджет на почтовый сервис.
*   **Разделение на задачи:** Проджект-менеджер или тимлид разбивает техническое задание на конкретные задачи в трекере (Jira, Trello):
    *   *Задача 1:* Проектирование и создание таблицы `one_time_links`.
    *   *Задача 2:* Реализация эндпоинта генерации ссылки.
    *   *Задача 3:* Реализация эндпоинта обработки перехода по ссылке.
    *   *Задача 4:* Интеграция с сервисом отправки email.
    *   *Задача 5:* Создание интерфейса для генерации ссылок.
    *   *Задача 6:* Тестирование функционала.
    *   *Задача 7:* Написание инструкции для пользователей.
*   **Определение сроков и ответственных:** На каждую задачу назначается исполнитель и срок выполнения. Строится общий план-график проекта.

**3. Выполнение (Реализация)**
*   **Непосредственная работа команды:** Разработчики пишут код, тестировщики проверяют готовый функционал на тестовом стенде.
*   **Контроль и координация:** Проджект-менеджер проводит ежедневные стендапы, отслеживает прогресс по задачам, обновляет план-график.


**4. Оценка результатов (Мониторинг и контроль)**
*   **Непрерывная проверка:** На протяжении всего этапа выполнения ведется тестирование, проверяется соответствие кода стандартам, проводится приемка завершенных задач.
*   **Финальная оценка:** После завершения разработки проводится финальное UAT-тестирование (User Acceptance Testing) с привлечением будущих пользователей (менеджеров, IT-специалистов). Проверяется, достигнута ли SMART-цель: работает ли механизм, безопасен ли он, решает ли он исходную проблему.

**5. Завершение**
*   **Ввод в эксплуатацию:** Написана финальная инструкция, проведено обучение сотрудников, функционал размещен на боевых серверах и официально передан в эксплуатацию отделу IT.
*   **Формальное закрытие:** Составлен итоговый отчет: какие работы выполнены, сколько ресурсов затрачено, какие цели достигнуты. Команда проекта распущена или переведена на другие задачи.
*   **Пост-проектный анализ** (опционально, но желательно): Через месяц после внедрения оценивается статистика использования сервиса и собирается обратная связь от пользователей для возможных улучшений в будущем.

### Бизнес-задача: Обеспечение безопасной передачи паролей между сотрудниками

Суть задачи - искоренить опасную практику передачи учетных данных через незащищенные каналы, такие как электронная почта, мессенджеры или бумажные записки.

*   **Необходимость решения:** В любой компании регулярно возникают ситуации, когда необходимо передать доступ к учетной записи. Это происходит во время отпусков и больничных, при онбординге новых сотрудников, при предоставлении доступа фрилансерам или во время сброса пароля службой поддержки.
*   **Риски текущих методов:** Использование неподходящих методов создает для компании критические риски:
    *   **Перехват:** Пароли могут быть перехвачены злоумышленниками при передаче.
    *   **Постоянное воздействие:** Пароль, отправленный по почте или в чате, остается в истории переписки навсегда. Если аккаунт взломают, злоумышленник получит доступ ко всем когда-либо переданным паролям.
    *   **Отсутствие контроля:** Тот, кто поделился паролем, не может отозвать доступ. Получатель может использовать пароль неограниченно долго.
    *   **Невозможность аудита:** Отсутствуют логи: кто, кому, когда и какой пароль передал. При инциденте безопасности невозможно установить причину.

### Анализ готовых систем и их недостатков

Рассмотрим два основных типа решений: общие инструменты коммуникации и специализированные менеджеры паролей, включая self-hosted решения.

| Готовая система | Ключевые недостатки |
| :--- | :--- |
| **Почта и Мессенджеры** | ❌ **Крайне небезопасно:** уязвимы для перехвата и взлома аккаунтов.<br>❌ **Нет контроля доступа:** пароли остаются доступными бессрочно.<br>❌ **Нет логов использования:** невозможно отследить, кто получил доступ. |
| **Корпоративные менеджеры паролей (1Password, Keeper)** | ⚠️ **Зависимость от платформы:** получателю часто требуется аккаунт в той же системе.<br>⚠️ **Ограниченная гибкость:** решение "как есть", сложно адаптировать под уникальные процессы компании.<br>⚠️ **Привязка к вендору:** компания зависит от ценовой политики и функционала поставщика. |
| **Vaultwarden (self-hosted менеджер паролей, форк Bitwarden)** | ⚠️ **Сложность настройки и поддержки:** требуется собственный сервер, экспертиза для развертывания и поддержки, регулярное обновление.<br>⚠️ **Ориентация на личное использование:** хотя он и корпоративный, его модель совместного использования (Collections) может быть менее гибкой для специфичных бизнес-процессов по сравнению с кастомным решением.<br>⚠️ **Избыточность:** Компании может быть не нужен весь функционал полноценного менеджера паролей, а только модуль безопасного обмена. |

**Вывод по Vaultwarden:** Это отличная и безопасная альтернатива коммерческим менеджерам паролей, которая решает проблему вендорской зависимости. Однако она требует технических ресурсов для поддержки и, как и любое готовое решение, может не идеально соответствовать уникальным внутренним процессам компании без доработок.

### 🚀 Как кастомная разработка решает эти проблемы

Индивидуальная разработка приложения позволяет преодолеть ограничения готовых решений и идеально встроиться в процессы и политики безопасности компании. Такое приложение может иметь следующие функции:

*   **Одноразовые ссылки:** Генерация ссылок для доступа к паролю, которые становятся недействительными после первого использования или через заданное время (например, час).
*   **Временный доступ:** Автоматический отзыв доступа по истечении заданного срока, что исключает риск "забытых" прав.
*   **Детальный аудит-лог:** Фиксация каждого действия: кто, что, кому, когда передал и была ли ссылка использована. Это гарантирует полную подотчетность.
*   **Бесшовная интеграция:** Приложение можно интегрировать с корпоративной Active Directory для автоматической идентификации пользователей и с внутренними порталами для единого опыта.
*   **Полный контроль и независимость:** Контроль над развитием продукта остается внутри компании, исходный код доступен, лицензионные ограничения отсутствуют, необходимая экспертиза и ключевые навыки так же находятся внутри бизнес-структуры.


## Архитектурное решение: Микросервисный подход

Для системы безопасной передачи паролей подходит микросервисная архитектура, потому что систему можно разделить на независимые модули, которые будут запускаться отдельно.

### Схема микросервисной архитектуры:

```
┌─────────────────┐    ┌─────────────────────────────────┐    ┌─────────────────┐
│   Web Client    │◄──►│        API Gateway             │◄──►│  Auth Service   │
│   (Frontend)    │    │                                 │    │                 │
└─────────────────┘    └─────────────────────────────────┘    └─────────────────┘
                                │           │                           │
                                │           │                           │
                                ▼           ▼                           ▼
                    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
                    │  Link Service   │    │ Notification    │    │  User Service   │
                    │                 │    │    Service      │    │                 │
                    └─────────────────┘    └─────────────────┘    └─────────────────┘
                            │                       │
                            │                       │
                            ▼                       ▼
                    ┌─────────────────┐    ┌─────────────────┐
                    │  Link Database  │    │  Email Queue    │
                    │   (PostgreSQL)  │    │   (RabbitMQ)    │
                    └─────────────────┘    └─────────────────┘
```

### Описание микросервисов:

#### 1. **API Gateway**
**Назначение:** Единая точка входа для всех клиентских запросов
**Обязанности:**
- Маршрутизация запросов к соответствующим микросервисам
- Аутентификация и авторизация запросов
- Rate limiting и защита от DDoS-атак
- Агрегация данных от нескольких сервисов
**API endpoints:**
- `POST /api/links` - создание одноразовой ссылки
- `GET /api/links/{token}` - валидация и использование ссылки
- `GET /api/links` - получение истории созданных ссылок (для аудита)

#### 2. **Auth Service**
**Назначение:** Управление аутентификацией и авторизацией
**Обязанности:**
- Аутентификация сотрудников через корпоративный LDAP/Active Directory
- Генерация JWT токенов
- Проверка прав доступа для операций
**База данных:** Redis для хранения сессий

#### 3. **Link Service** (Основной бизнес-сервис)
**Назначение:** Управление жизненным циклом одноразовых ссылок
**Обязанности:**
- Генерация криптостойких токенов
- Валидация и активация ссылок
- Управление временем жизни ссылок
- Ведение аудит-лога операций
**База данных:** PostgreSQL
**Модель данных:**
```sql
CREATE TABLE one_time_links (
    id UUID PRIMARY KEY,
    token_hash VARCHAR(512) NOT NULL,
    recipient_email VARCHAR(255) NOT NULL,
    created_by_user_id UUID NOT NULL,
    expires_at TIMESTAMP NOT NULL,
    used_at TIMESTAMP NULL,
    target_system VARCHAR(100) NULL,
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### 4. **Notification Service**
**Назначение:** Отправка уведомлений
**Обязанности:**
- Отправка email с одноразовыми ссылками
- Отправка уведомлений в корпоративные мессенджеры
- Очередь сообщений для асинхронной отправки
**Интеграции:** SMTP-сервер, RabbitMQ/Kafka

#### 5. **User Service**
**Назначение:** Управление информацией о пользователях
**Обязанности:**
- Профили сотрудников
- Ролевая модель и права доступа
- Интеграция с корпоративной AD
**База данных:** PostgreSQL

### Способы взаимодействия микросервисов:

#### 1. **Синхронное взаимодействие (HTTP/REST)**
```typescript
// API Gateway -> Auth Service
POST /auth/verify-token
{
  "token": "jwt-token"
}

// API Gateway -> Link Service  
POST /links
{
  "recipientEmail": "user@company.com",
  "expiresInHours": 24,
  "targetSystem": "CRM"
}
```

#### 2. **Асинхронное взаимодействие (Event-Driven через RabbitMQ)**
```typescript
// Link Service публикует событие
{
  "eventType": "LINK_CREATED",
  "data": {
    "linkId": "uuid",
    "recipientEmail": "user@company.com", 
    "token": "secure-token",
    "expiresAt": "2024-12-01T12:00:00Z"
  }
}

// Notification Service подписывается на событие и отправляет email
```

#### 3. **Схема работы создания ссылки:**

```
1. Frontend → API Gateway: POST /api/links
2. API Gateway → Auth Service: проверка JWT токена
3. API Gateway → Link Service: создание ссылки
4. Link Service → Database: сохранение ссылки
5. Link Service → RabbitMQ: публикация LINK_CREATED
6. Notification Service ← RabbitMQ: получение события
7. Notification Service → SMTP: отправка email
```

### Преимущества такого разделения:

1. **Независимое масштабирование:** 
   - Notification Service можно масштабировать при высокой нагрузке на отправку email
   - Link Service масштабируется при частых операциях создания/валидации ссылок

2. **Технологическая гибкость:**
   - Каждый сервис может использовать оптимальный стек технологий
   - Можно легко заменить провайдера email без влияния на другие сервисы

3. **Устойчивость:**
   - Падение Notification Service не влияет на создание ссылок
   - Ссылки продолжают работать даже при проблемах с отправкой email

4. **Независимость разработки:**
   - Разные команды могут работать над отдельными сервисами
   - Упрощается тестирование и развертывание

### Рекомендации по внедрению:

1. **Поэтапный переход:** Начать с монолита, затем выделить Notification Service, затем Auth Service
2. **Использовать "Strangler Fig" паттерн:** Новый функционал реализовывать в микросервисах, постепенно мигрируя старый
3. **Внедрить centralized logging:** ELK-стек для агрегации логов всех сервисов
4. **Реализовать health checks:** Для мониторинга состояния каждого микросервиса

Такая архитектура обеспечивает масштабируемость, отказоустойчивость и возможность независимого развития компонентов системы.


## Применение Git в разработке системы безопасной передачи паролей

### Организация репозитория проекта

**Структура репозитория:**
```
password-transfer-system/
├── .git/
├── .gitignore
├── README.md
├── backend/
│   ├── api-gateway/
│   ├── auth-service/
│   ├── link-service/
│   ├── notification-service/
│   └── user-service/
├── frontend/
│   ├── admin-panel/
│   └── user-interface/
├── infrastructure/
│   ├── docker-compose.yml
│   ├── kubernetes/
│   └── database/
├── docs/
└── scripts/
```

### Стратегия ветвления (Git Branching Strategy)

Для нашего микросервисного проекта оптимально подходит **GitFlow**:

```bash
# Основные ветки
main/master      - стабильная версия (продакшен)
develop          - текущая разработка

# Вспомогательные ветки
feature/         - новая функциональность
release/         - подготовка к релизу
hotfix/         - срочные исправления в продакшене
```

### Пример рабочего процесса для разработки нового функционала

#### 1. Создание ветки для новой функции
```bash
# Переключаемся на develop
git checkout develop
git pull origin develop

# Создаем ветку для новой функции
git checkout -b feature/link-expiration-notifications
```

#### 2. Разработка бранче
```bash
# Добавляем изменения
git add notification-service/src/expiration-notifier.js
git commit -m "feat: add link expiration notification system"

# Продолжаем разработку
git add notification-service/tests/expiration-test.js
git commit -m "test: add expiration notification tests"
```

#### 3. Слияние
```bash
# Переключаемся на develop и обновляем ее
git checkout develop
git pull origin develop

# Возвращаемся к feature ветке и объединяем изменения
git checkout feature/link-expiration-notifications
git rebase develop

# Решаем возможные конфликты, пушим
git push origin feature/link-expiration-notifications
```

### Работа команды над микросервисами

#### Параллельная разработка разных сервисов:

**Команда 1 (Auth Service):**
```bash
git checkout -b feature/jwt-refresh-tokens
# Разработка механизма обновления JWT токенов
```

**Команда 2 (Link Service):**
```bash
git checkout -b feature/link-usage-analytics
# Добавление аналитики использования ссылок
```

**Команда 3 (Frontend):**
```bash
git checkout -b feature/admin-dashboard
# Создание админ-панели для мониторинга
```

### CI/CD интеграция

**.gitlab-ci.yml пример:**
```yaml
stages:
  - test
  - build
  - deploy

unit_tests:
  stage: test
  script:
    - cd auth-service && npm test
    - cd link-service && npm test
    - cd notification-service && npm test

build_services:
  stage: build
  script:
    - docker build -t auth-service ./auth-service
    - docker build -t link-service ./link-service
    - docker build -t notification-service ./notification-service

deploy_staging:
  stage: deploy
  only:
    - develop
  script:
    - kubectl apply -f infrastructure/kubernetes/staging/
```

### Работа с конфликтами при слиянии микросервисов

**Типичный сценарий конфликта:**
```bash
# Две команды изменили общий конфигурационный файл
git checkout develop
git pull origin develop
git checkout feature/my-feature
git rebase develop

# CONFLICT: Merge conflict in shared/config.yaml
```

**Решение конфликта:**
```bash
# Открываем файл в редакторе
code shared/config.yaml

# Видим конфликт:
<<<<<<< HEAD
database_url: postgresql://localhost:5432/auth_prod
=======
database_url: postgresql://localhost:5432/auth_staging
>>>>>>> feature/my-feature

# Решаем конфликт, выбирая правильную версию
database_url: postgresql://localhost:5432/auth_staging

# Сохраняем и продолжаем
git add shared/config.yaml
git rebase --continue
```

### Best Practices для нашего проекта

#### 1. Структура коммитов
```bash
# Хорошие примеры коммитов:
git commit -m "feat(auth): implement JWT token refresh mechanism"
git commit -m "fix(link-service): resolve token validation race condition"
git commit -m "docs: update API documentation for link creation"
git commit -m "test(notification): add email delivery tests"
```

#### 2. .gitignore для микросервисов
```gitignore
# Общие исключения
node_modules/
.env
*.log
dist/
build/

# Специфичные для сервисов
auth-service/.env.local
link-service/database.db
notification-service/attachments/
```

#### 3. Использование тегов для версионирования
```bash
# После успешного релиза
git tag -a v1.2.0 -m "Release 1.2.0: Added link expiration notifications"
git push origin v1.2.0
```

### Мониторинг и аналитика Git

**Полезные команды для анализа проекта:**
```bash
# Просмотр активности по веткам
git log --oneline --graph --all

# Анализ вклада разработчиков
git shortlog -sn

# Поиск изменений в конкретном файле
git log -p -- infrastructure/database/schema.sql

# Проверка статуса всех микросервисов
git submodule status
```

Такой подход к использованию Git обеспечит эффективную совместную работу над системой безопасной передачи паролей, позволит поддерживать порядок в кодовой базе и обеспечит бесперебойный процесс непрерывной интеграции и доставки.

### Расчет себестоимости разработки

В таблице ниже приведена детализация расчетов для проекта средней сложности, который реализуется силами выделенной команды на аутсорсе.

| Статья расходов | Расчет | Итого, руб. |
| :--- | :--- | :--- |
| **Команда (7 месяцев)** | | |
| Руководитель проекта | 120 000 руб./мес. × 7 мес. | 840 000 |
| Системный аналитик | 110 000 руб./мес. × 4 мес. | 440 000 |
| Backend-разработчик (Middle+) | 150 000 руб./мес. × 7 мес. | 1 050 000 |
| Frontend-разработчик (Middle) | 130 000 руб./мес. × 6 мес. | 780 000 |
| DevOps-инженер | 130 000 руб./мес. × 3 мес. | 390 000 |
| Тестировщик | 90 000 руб./мес. × 5 мес. | 450 000 |
| **Итого по команде** | | **3 950 000** |
| **Инфраструктура (год)** | | |
| Серверы (3 виртуальные машины) | ~15 000 руб./мес. × 12 мес. | 180 000 |
| Базы данных, мониторинг, брокер сообщений | ~10 000 руб./мес. × 12 мес. | 120 000 |
| Домены и SSL-сертификаты | 5 000 руб./год | 5 000 |
| **Итого по инфраструктуре** | | **305 000** |
| **Внешние сервисы и ПО** | | |
| Лицензия на IDE (2 шт.) | 7 500 руб./год × 2 | 15 000 |
| Подписка на сервис email-рассылок | ~5 000 руб./мес. × 12 мес. | 60 000 |
| **Итого по сервисам и ПО** | | **75 000** |
| **Накладные расходы (15%)** | (Команда + Инфраструктура + ПО) × 15% | **649 500** |
| **Резерв на риски (20%)** | (Команда + Инфраструктура + ПО + Накладные) × 20% | **995 900** |
| **ПОЛНАЯ ПРЕДВАРИТЕЛЬНАЯ СЕБЕСТОИМОСТЬ** | | **4 975 400** |

### Обоснование расчетов

Приведенная себестоимость является **предварительной оценкой**, точность которой составляет около ±25% . Вот ключевые допущения, заложенные в расчет:

-   **Метод оценки**: Применен гибридный подход. Сначала использован **метод "снизу-вверх"** для оценки трудозатрат каждого специалиста , а затем **параметрический метод**, где базовым параметром выступает стоимость человеко-месяца для разных ролей .
-   **Сложность проекта**: Проект отнесен к категории **средней сложности** . Это обусловлено наличием нескольких микросервисов, необходимостью интеграции с внешними системами (email, корпоративная AD) и реализацией сложной бизнес-логики, связанной с безопасностью.
-   **Накладные расходы**: В 15% заложены расходы на администрирование, рабочее место, бухгалтерское сопровождение и прочие общеорганизационные затраты .
-   **Резерв на риски**: 20% - стандартная практика для покрытия таких рисков, как уточнение и изменение требований в процессе работы, возможные болезни сотрудников и иные форс-мажоры .


